<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bo.ucb.edu.medichub.dao.ReserveDao">
    <insert id="createReserve" parameterType="bo.ucb.edu.medichub.model.Reserve">
        INSERT INTO reserve VALUES (
            null, #{clientId}, #{date}, #{statusReserve},
            1, #{transaction.txId}, #{transaction.txHost}, #{transaction.txUserId}, #{transaction.txDate}
        )
    </insert>


    <select id="getListReserve" resultMap="reserveListMap">
        SELECT
        a.reserve_id as reserveId,
        a.client_id as clientId
        FROM reserve a
        WHERE
        a.status = 1
        and a.status_reserve = #{state}
        ORDER BY a.date DESC
        LIMIT #{size} OFFSET #{page}
    </select>


    <resultMap id="reserveListMap" type="bo.ucb.edu.medichub.dto.ReserveRequest">
        <result column="reserveId" property="reserveId"/>
        <result column="clientId" property="clientId"/>
    </resultMap>




    <select id="getListProductReserve" resultMap="productReserveListMap">
        SELECT
        c.product_id as productId,
        c.name as name,
        c.price as price,
        b.quantity as quantity
        FROM product_reserve b, product c
        WHERE
        b.product_id = c.product_id and
        b.reserve_id = #{reserveId} and
        b.status = 1
        ORDER BY c.name DESC
    </select>
    <resultMap id="productReserveListMap" type="bo.ucb.edu.medichub.dto.ProductReserveRequest">
        <result column="productId" property="productId"/>
        <result column="name" property="name"/>
        <result column="price" property="price"/>
        <result column="quantity" property="quantity"/>
    </resultMap>

    <select id="getLastReserveStatus" resultType="java.lang.Integer">
        SELECT
            status_reserve
        FROM reserve
        WHERE
            client_id = #{clientId}
    </select>
</mapper>
